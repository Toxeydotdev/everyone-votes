<p-card
  header="{{ poll().poll_title }}"
  class="flex flex-grow-1 p-0"
  styleClass="w-full lg:w-25rem surface-50"
>
  <ng-template pTemplate="header">
    <div class="flex border-round-top overflow-hidden">
      <img
        *ngFor="let image of poll().poll_option_image_urls"
        class="w-6 h-auto"
        src="{{ image }}"
        alt="poll option"
      />
    </div>
  </ng-template>

  <p class="m-0 text-wrap">
    {{ poll().poll_description }}
  </p>

  <ng-template pTemplate="footer">
    <div class="w-full flex gap-3 mb-3">
      <button
        *ngFor="let button of buttons(); index as i"
        pButton
        pRipple
        [severity]="
          alreadyVoted() && poll().userVote?.option_selected === i
            ? 'success'
            : 'secondary'
        "
        (click)="handleSelection(i)"
        [disabled]="alreadyVoted() || processing()"
        [outlined]="!button.isSelected"
        [raised]="button.isSelected"
        label="{{ button.label }}"
        class="flex-grow-1"
      ></button>
    </div>
    <!-- force ui refresh after submitting vote -->
    <div class="w-full flex gap-3" *ngIf="buttons()">
      <button
        pButton
        pRipple
        [disabled]="optionSelected() || alreadyVoted()"
        (click)="handleSubmit(poll().id)"
        [loading]="processing()"
        [severity]="'success'"
        [raised]="true"
        label="{{
          alreadyVoted() ? 'Already Voted' : processing() ? 'Voting' : 'Vote'
        }}"
        class="flex-grow-1"
      ></button>
    </div>

    <div *ngIf="alreadyVoted()" class="slidedown-animation overflow-hidden">
      <p-divider />
      <div class="mt-3 text-center">
        {{ this.poll().poll_votes_total }} total votes
      </div>
      <div class="mt-3">
        <p-meterGroup [value]="meterValues()" />
      </div>
    </div>
  </ng-template>
</p-card>
